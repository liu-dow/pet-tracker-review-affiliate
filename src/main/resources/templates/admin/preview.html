<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${lang == 'zh' ? 'YAML内容预览 - Pet Tracker Review' : 'YAML Content Preview - Pet Tracker Review'}">YAML Content Preview - Pet Tracker Review</title>
    <link rel="stylesheet" th:href="@{/css/pages/admin-dashboard.css}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .admin-layout {
            display: grid;
            grid-template-columns: 250px 1fr;
            min-height: 100vh;
        }
        .admin-sidebar {
            background-color: #2d3748;
            color: white;
            padding: 2rem 0;
        }
        .admin-content {
            padding: 2rem;
            background-color: #f7fafc;
        }
        .sidebar-header {
            padding: 0 1.5rem;
            margin-bottom: 2rem;
        }
        .sidebar-nav {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .sidebar-nav li a {
            display: block;
            padding: 1rem 1.5rem;
            color: #a0aec0;
            text-decoration: none;
            transition: all 0.2s;
        }
        .sidebar-nav li a:hover {
            background-color: #4a5568;
            color: white;
        }
        .sidebar-nav li a i {
            margin-right: 0.5rem;
            width: 16px;
        }
        .preview-container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .language-switcher {
            float: right;
            margin-bottom: 1rem;
        }
        .language-switcher button {
            background: #3182ce;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            margin: 0 0.25rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .language-switcher button:hover {
            background: #2c5aa0;
        }
        .language-switcher button.active {
            background: #1a365d;
        }
        .preview-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
        }
        .preview-header {
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 1rem;
            margin-bottom: 2rem;
        }
        .preview-metadata {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            background: #f7fafc;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid #3182ce;
            margin-bottom: 2rem;
        }
        .metadata-item {
            display: flex;
            flex-direction: column;
        }
        .metadata-label {
            font-weight: 600;
            color: #4a5568;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }
        .metadata-value {
            color: #1a202c;
        }
        .content-preview {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 2rem;
        }
        .content-preview h1, .content-preview h2, .content-preview h3 {
            margin-top: 0;
        }
        .rating-display {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .stars {
            color: #f6ad55;
        }
        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background-color: #3182ce;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s;
            margin-right: 1rem;
        }
        .btn:hover {
            background-color: #2c5aa0;
        }
        .btn-success {
            background-color: #38a169;
        }
        .btn-success:hover {
            background-color: #2f855a;
        }
        .btn-outline {
            background-color: transparent;
            color: #3182ce;
            border: 1px solid #3182ce;
        }
        .btn-outline:hover {
            background-color: #3182ce;
            color: white;
        }
        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
        }
        .alert-error {
            background-color: #fed7d7;
            color: #742a2a;
            border: 1px solid #f56565;
        }
        .action-buttons {
            text-align: center;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e2e8f0;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="sidebar-header">
                <h3><i class="fas fa-paw"></i> Admin Panel</h3>
            </div>
            <nav>
                <ul class="sidebar-nav">
                    <li><a href="/admin/dashboard"><i class="fas fa-home"></i> <span class="nav-text" data-en="Dashboard" data-zh="仪表板">Dashboard</span></a></li>
                    <li><a href="/admin/blogs"><i class="fas fa-blog"></i> <span class="nav-text" data-en="Blogs" data-zh="博客">Blogs</span></a></li>
                    <li><a href="/admin/reviews"><i class="fas fa-star"></i> <span class="nav-text" data-en="Reviews" data-zh="评测">Reviews</span></a></li>
                    <li><a href="/admin/images"><i class="fas fa-images"></i> <span class="nav-text" data-en="Images" data-zh="图片">Images</span></a></li>
                    <li><a href="/admin/ai-content-generator"><i class="fas fa-robot"></i> <span class="nav-text" data-en="AI Content Generator" data-zh="AI内容生成器">AI Content Generator</span></a></li>
                    <li><a href="/admin/import"><i class="fas fa-upload"></i> <span class="nav-text" data-en="Import Data" data-zh="导入数据">Import Data</span></a></li>
                    <li><a href="#" onclick="exportContent()"><i class="fas fa-download"></i> <span class="nav-text" data-en="Export Data" data-zh="导出数据">Export Data</span></a></li>
                    <li><a href="/"><i class="fas fa-external-link-alt"></i> <span class="nav-text" data-en="View Site" data-zh="查看网站">View Site</span></a></li>
                    <li><a href="/admin/logout"><i class="fas fa-sign-out-alt"></i> <span class="nav-text" data-en="Logout" data-zh="登出">Logout</span></a></li>
                </ul>
            </nav>
        </aside>
        
        <!-- Main Content -->
        <main class="admin-content">
            <div class="language-switcher">
                <button type="button" onclick="switchLanguage('en')" id="btnEn" th:class="${lang == 'en' ? 'active' : ''}">English</button>
                <button type="button" onclick="switchLanguage('zh')" id="btnZh" th:class="${lang == 'zh' ? 'active' : ''}">中文</button>
            </div>
            
            <h1><i class="fas fa-eye"></i> <span class="title-text" data-en="YAML Content Preview" data-zh="YAML内容预览">YAML Content Preview</span></h1>
            
            <div class="preview-container">
                <!-- Error Message -->
                <div th:if="${errorMessage}" class="alert alert-error">
                    <i class="fas fa-exclamation-circle"></i> <span th:text="${errorMessage}"></span>
                </div>
                
                <!-- Success Preview -->
                <div th:if="${previewResult != null and previewResult.success}">
                    <div class="preview-card">
                        <div class="preview-header">
                            <h2>
                                <i th:class="${contentType == 'blogs' ? 'fas fa-blog' : 'fas fa-star'}"></i>
                                <span class="content-type-text" th:attr="data-en=${contentType == 'blogs' ? 'Blog Post Preview' : 'Review Preview'}, data-zh=${contentType == 'blogs' ? '博客文章预览' : '评测文章预览'}" th:text="${contentType == 'blogs' ? 'Blog Post Preview' : 'Review Preview'}">Content Preview</span>
                            </h2>
                            <p class="file-info-text" th:attr="data-en=${'File: ' + previewResult.fileName}, data-zh=${'文件：' + previewResult.fileName}">
                                <span class="file-label" data-en="File:" data-zh="文件：">File:</span> <span th:text="${previewResult.fileName}"></span>
                            </p>
                        </div>
                        
                        <!-- Blog Post Preview -->
                        <div th:if="${contentType == 'blogs' and blogPost != null}">
                            <div class="preview-metadata">
                                <div class="metadata-item">
                                    <span class="metadata-label" data-en="Title" data-zh="标题">Title</span>
                                    <span class="metadata-value" th:text="${blogPost.title}"></span>
                                </div>
                                <div class="metadata-item">
                                    <span class="metadata-label" data-en="Author" data-zh="作者">Author</span>
                                    <span class="metadata-value" th:text="${blogPost.author}"></span>
                                </div>
                                <div class="metadata-item">
                                    <span class="metadata-label" data-en="Date" data-zh="日期">Date</span>
                                    <span class="metadata-value" th:text="${#temporals.format(blogPost.date, 'yyyy-MM-dd HH:mm')}"></span>
                                </div>
                                <div class="metadata-item">
                                    <span class="metadata-label" data-en="Slug" data-zh="链接标识">Slug</span>
                                    <span class="metadata-value" th:text="${blogPost.slug}"></span>
                                </div>
                                <div class="metadata-item" th:if="${blogPost.tags != null and !blogPost.tags.isEmpty()}">
                                    <span class="metadata-label" data-en="Tags" data-zh="标签">Tags</span>
                                    <span class="metadata-value" th:text="${#strings.listJoin(blogPost.tags, ', ')}"></span>
                                </div>
                                <div class="metadata-item" th:if="${blogPost.metaDescription != null and !blogPost.metaDescription.isEmpty()}">
                                    <span class="metadata-label" data-en="Meta Description" data-zh="SEO描述">Meta Description</span>
                                    <span class="metadata-value" th:text="${blogPost.metaDescription}"></span>
                                </div>
                            </div>
                            
                            <div class="content-preview">
                                <div th:utext="${#strings.replace(#strings.replace(blogPost.content, '
', '<br>'), '##', '<h2>').replaceAll('\\*\\*([^*]+)\\*\\*', '<strong>$1</strong>')}"></div>
                            </div>
                        </div>
                        
                        <!-- Review Preview -->
                        <div th:if="${contentType == 'reviews' and review != null}">
                            <div class="preview-metadata">
                                <div class="metadata-item">
                                    <span class="metadata-label" data-en="Title" data-zh="标题">Title</span>
                                    <span class="metadata-value" th:text="${review.title}"></span>
                                </div>
                                <div class="metadata-item">
                                    <span class="metadata-label" data-en="Product Brand" data-zh="产品品牌">Product Brand</span>
                                    <span class="metadata-value" th:text="${review.productBrand}"></span>
                                </div>
                                <div class="metadata-item" th:if="${review.productName != null and !review.productName.isEmpty()}">
                                    <span class="metadata-label" data-en="Product Name" data-zh="产品名称">Product Name</span>
                                    <span class="metadata-value" th:text="${review.productName}"></span>
                                </div>
                                <div class="metadata-item">
                                    <span class="metadata-label" data-en="Rating" data-zh="评分">Rating</span>
                                    <div class="rating-display">
                                        <span class="stars" th:text="${review.starRating}"></span>
                                        <span th:text="'(' + review.rating + '/5)'"></span>
                                    </div>
                                </div>
                                <div class="metadata-item">
                                    <span class="metadata-label" data-en="Date" data-zh="日期">Date</span>
                                    <span class="metadata-value" th:text="${#temporals.format(review.date, 'yyyy-MM-dd HH:mm')}"></span>
                                </div>
                                <div class="metadata-item">
                                    <span class="metadata-label" data-en="Slug" data-zh="链接标识">Slug</span>
                                    <span class="metadata-value" th:text="${review.slug}"></span>
                                </div>
                                <div class="metadata-item" th:if="${review.tags != null and !review.tags.isEmpty()}">
                                    <span class="metadata-label" data-en="Tags" data-zh="标签">Tags</span>
                                    <span class="metadata-value" th:text="${#strings.listJoin(review.tags, ', ')}"></span>
                                </div>
                            </div>
                            
                            <div class="content-preview">
                                <div th:utext="${#strings.replace(#strings.replace(review.content, '
', '<br>'), '##', '<h2>').replaceAll('\\*\\*([^*]+)\\*\\*', '<strong>$1</strong>')}"></div>
                                
                                <div th:if="${review.pros != null and !review.pros.isEmpty()}" style="margin-top: 2rem;">
                                    <h3 class="pros-title" data-en="Pros" data-zh="优点">Pros</h3>
                                    <div th:utext="${#strings.replace(review.pros, '
', '<br>')}"></div>
                                </div>
                                
                                <div th:if="${review.cons != null and !review.cons.isEmpty()}" style="margin-top: 1.5rem;">
                                    <h3 class="cons-title" data-en="Cons" data-zh="缺点">Cons</h3>
                                    <div th:utext="${#strings.replace(review.cons, '
', '<br>')}"></div>
                                </div>
                                
                                <div th:if="${review.conclusion != null and !review.conclusion.isEmpty()}" style="margin-top: 1.5rem;">
                                    <h3 class="conclusion-title" data-en="Conclusion" data-zh="总结">Conclusion</h3>
                                    <div th:utext="${#strings.replace(review.conclusion, '
', '<br>')}"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="action-buttons">
                            <form method="post" th:action="@{/admin/import-from-preview}" style="display: inline;" onsubmit="return confirmImport()">
                                <input type="hidden" name="contentType" th:value="${contentType}">
                                <input type="hidden" name="lang" th:value="${lang}">
                                <input type="hidden" name="previewData" th:value="${previewResult.rawContent}">
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-check"></i> <span class="import-btn-text" data-en="Confirm Import" data-zh="确认导入">Confirm Import</span>
                                </button>
                            </form>
                            <a href="/admin/import" class="btn btn-outline">
                                <i class="fas fa-arrow-left"></i> <span class="back-btn-text" data-en="Back to Import" data-zh="返回导入页面">Back to Import</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script th:inline="javascript">
        let currentLang = /*[[${lang != null ? lang : 'en'}]]*/ 'en';
        
        function switchLanguage(lang) {
            currentLang = lang;
            updateLanguageDisplay();
            
            // Update active button
            document.getElementById('btnEn').classList.toggle('active', lang === 'en');
            document.getElementById('btnZh').classList.toggle('active', lang === 'zh');
        }
        
        function updateLanguageDisplay() {
            const elements = document.querySelectorAll('[data-en][data-zh]');
            elements.forEach(element => {
                const text = currentLang === 'zh' ? element.getAttribute('data-zh') : element.getAttribute('data-en');
                if (text) {
                    element.textContent = text;
                }
            });
        }
        
        function confirmImport() {
            const message = currentLang === 'zh' ? 
                '确定要将这个YAML文件导入到系统中吗？' : 
                'Are you sure you want to import this YAML file into the system?';
            return confirm(message);
        }
        
        function exportContent() {
            // Create a temporary link and trigger download
            const link = document.createElement('a');
            link.href = '/admin/export';
            link.download = '';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Initialize language display
        document.addEventListener('DOMContentLoaded', function() {
            updateLanguageDisplay();
        });
    </script>
</body>
</html>