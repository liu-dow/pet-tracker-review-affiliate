<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Management - Admin Panel</title>
    <link rel="stylesheet" th:href="@{/css/pages/admin-dashboard.css}">
    <th:block th:replace="~{fragments/admin-panel :: admin-styles}"></th:block>
    <style>
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e2e8f0;
        }
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 1.5rem;
            font-weight: 600;
            color: #3182ce;
        }
        .stat-label {
            color: #718096;
            font-size: 0.9rem;
        }
        .filters-section {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .filters-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 1rem;
            align-items: end;
        }
        .images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }
        .image-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .image-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .image-preview {
            position: relative;
            height: 200px;
            overflow: hidden;
            background: #f8f9fa;
        }
        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .image-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .image-card:hover .image-overlay {
            opacity: 1;
        }
        .image-actions {
            display: flex;
            gap: 0.5rem;
        }
        .image-info {
            padding: 1rem;
        }
        .image-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #2d3748;
        }
        .image-meta {
            font-size: 0.85rem;
            color: #718096;
            margin-bottom: 0.5rem;
        }
        .image-description {
            font-size: 0.9rem;
            color: #4a5568;
            margin-bottom: 1rem;
        }
        .image-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
        }
        .tag {
            background: #e2e8f0;
            color: #4a5568;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #2d3748;
        }
        .form-control {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #718096;
        }
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #cbd5e0;
        }
    </style>
</head>
<body>
    <th:block th:replace="~{fragments/admin-panel :: admin-layout('images', 'Image Management')}">
        <th:block th:fragment="content">
            <!-- Page Header -->
            <div class="page-header">
                <div>
                    <h1><i class="fas fa-images"></i> Image Management</h1>
                    <p>Manage your website images and compress photos</p>
                </div>
                <a href="/admin/images/new" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Upload New Image
                </a>
            </div>
            
            <!-- Flash Messages -->
            <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
            <div th:if="${errorMessage}" class="alert alert-error" th:text="${errorMessage}"></div>
            
            <!-- Statistics Bar -->
            <div class="stats-bar" th:if="${stats}">
                <div class="stat-card">
                    <div class="stat-number" th:text="${stats.totalImages}">0</div>
                    <div class="stat-label">Total Images</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" th:text="${#numbers.formatDecimal(stats.totalSize / 1024.0 / 1024.0, 1, 1)} + ' MB'">0 MB</div>
                    <div class="stat-label">Total Storage</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" th:text="${stats.categories}">0</div>
                    <div class="stat-label">Categories</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" th:text="${#dates.format(#dates.createNow(), 'MMM dd')}">Today</div>
                    <div class="stat-label">Last Updated</div>
                </div>
            </div>
            
            <!-- Filters -->
            <div class="filters-section">
                <form method="get" action="/admin/images">
                    <div class="filters-grid">
                        <div class="form-group">
                            <label class="form-label">Category</label>
                            <select name="category" class="form-control">
                                <option value="">All Categories</option>
                                <option th:each="cat : ${categories}" 
                                        th:value="${cat}" 
                                        th:text="${cat}"
                                        th:selected="${cat == currentCategory}"></option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Search</label>
                            <input type="text" name="search" class="form-control" 
                                   placeholder="Search by title, description, tags..." 
                                   th:value="${currentSearch}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">&nbsp;</label>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-search"></i> Filter
                            </button>
                        </div>
                        <div class="form-group">
                            <label class="form-label">&nbsp;</label>
                            <a href="/admin/images" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Clear
                            </a>
                        </div>
                    </div>
                </form>
            </div>
            
            <!-- Images Grid -->
            <div class="images-grid" th:if="${images != null and !images.isEmpty()}">
                <div class="image-card" th:each="image : ${images}">
                    <div class="image-preview">
                        <img th:src="${image.thumbnailPath != null ? '/' + image.thumbnailPath : '/' + image.filePath}" 
                             th:alt="${image.altText}" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div style="display:none; align-items:center; justify-content:center; background:#f0f0f0; color:#666; font-size:14px;">
                            <i class="fas fa-image" style="font-size:2rem;"></i>
                        </div>
                        <div class="image-overlay">
                            <div class="image-actions">
                                <a th:href="@{'/admin/images/edit/' + ${image.id}}" class="btn btn-sm btn-warning">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a th:href="${'/' + image.filePath}" target="_blank" class="btn btn-sm btn-primary">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <button type="button" class="btn btn-sm btn-danger" th:data-image-id="${image.id}" onclick="deleteImage(this.getAttribute('data-image-id'))">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="image-info">
                        <div class="image-title" th:text="${image.title}">Image Title</div>
                        <div class="image-meta">
                            <div><i class="fas fa-calendar"></i> <span th:text="${#temporals.format(image.uploadDate, 'MMM dd, yyyy HH:mm')}">Upload Date</span></div>
                            <div><i class="fas fa-expand-arrows-alt"></i> <span th:text="${image.dimensions}">Dimensions</span></div>
                            <div><i class="fas fa-hdd"></i> <span th:text="${image.formattedFileSize}">File Size</span></div>
                            <div th:if="${image.category}" class="tag" th:text="${image.category}">Category</div>
                        </div>
                        <div class="image-description" th:if="${image.description}" th:text="${image.description}">Description</div>
                        <div class="image-tags" th:if="${image.tags}">
                            <span class="tag" th:each="tag : ${#strings.listSplit(image.tags, ',')}" th:text="${#strings.trim(tag)}">Tag</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Empty State -->
            <div class="empty-state" th:if="${images == null or images.isEmpty()}">
                <i class="fas fa-images"></i>
                <h3>No images found</h3>
                <p>Upload your first image to get started</p>
                <a href="/admin/images/new" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Upload Image
                </a>
            </div>
        </th:block>
    </th:block>
    
    <th:block th:replace="~{fragments/admin-panel :: admin-scripts}"></th:block>
    
    <script>
        function deleteImage(imageId) {
            if (confirm('Are you sure you want to delete this image? This action cannot be undone.')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/admin/images/delete/' + imageId;
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
</body>
</html>